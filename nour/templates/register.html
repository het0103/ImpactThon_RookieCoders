{%extends 'base.html'%}
{% load static %}
{%block content%}
  <br>
  <div class="auth-page">
    <section class="auth-register">
      <div class="login" style="margin-top: 50px;">
        <form class="login_form" id="regForm">

          <h1 class="login_title">Create Account</h1>

          <div class="login__inputs">
            <!-- ROLE SELECTION -->
            <div class="login__box">
              <label class="login_label">I am a:</label>
              <select id="role" class="login_input" onchange="toggleFields()"
                style="background: rgba(255,255,255,0.25); color: inherit;">
                <option value="donor">Donor</option>
                <option value="ngo">NGO / Charity</option>
              </select>
            </div>

            <div class="login__box">
              <label for="name" class="login_label">Organization / Name:</label>
              <input id="name" type="text" placeholder="Enter Name" required />
            </div>

            <div class="login__box">
              <label for="regEmail" class="login_label">Email:</label>
              <input id="regEmail" type="email" placeholder="Enter Email" required />
            </div>

            <div class="login__box">
              <label for="mobile" class="login_label">Mobile No.:</label>
              <input id="mobile" type="tel" maxlength="10" placeholder="Enter Mobile" required />
            </div>

            <!-- NGO SPECIFIC FIELDS -->
            <div id="ngoFields" style="display: none;">
              <div class="login__box">
                <label for="address" class="login_label">Address:</label>
                <input id="address" type="text" placeholder="Enter Address" />
              </div>

              <div class="login__box">
                <label for="pincode" class="login_label">Pincode:</label>
                <input id="pincode" type="text" maxlength="6" placeholder="Enter Pincode" />
              </div>
            </div>

            <div class="login__box">
              <label for="pwd1" class="login_label">Password: </label>
              <input placeholder="Enter Password" id="pwd1" type="password" required />
            </div>
            <div class="login__box">
              <label for="pwd2" class="login_label">Confirm Password: </label>
              <input placeholder="Confirm Password" id="pwd2" type="password" required />
            </div>
          </div>

          <button type="submit" class="logine__button">Register</button>

          <div class="login__resister">
            Already have an account?
            <a href="/login">Login</a>
          </div>
        </form>
      </div>
    </section>

    <script>
      function toggleFields() {
        const role = document.getElementById('role').value;
        const ngoFields = document.getElementById('ngoFields');
        if (role === 'ngo') {
          ngoFields.style.display = 'block';
          document.getElementById('address').required = true;
        } else {
          ngoFields.style.display = 'none';
          document.getElementById('address').required = false;
        }
      }

      document.getElementById('regForm').addEventListener('submit', function (e) {
        e.preventDefault();

        const role = document.getElementById('role').value;
        const name = document.getElementById('name').value;
        const email = document.getElementById('regEmail').value;
        const password = document.getElementById('pwd1').value;
        const confirm = document.getElementById('pwd2').value;

        if (password !== confirm) {
          alert("Passwords do not match!");
          return;
        }

        // Save user
        const users = JSON.parse(localStorage.getItem('users')) || [];

        if (users.find(u => u.email === email)) {
          alert("User already exists!");
          return;
        }

        const newUser = {
          name,
          email,
          password,
          role,
          mobile: document.getElementById('mobile').value
        };

        users.push(newUser);
        localStorage.setItem('users', JSON.stringify(users));

        alert("Registration successful! Please login.");
        window.location.href = '/login';
      });
    </script>
    </div>
{%endblock%}